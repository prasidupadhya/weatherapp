const metaTheme=document.querySelector("meta[name = 'theme-color']"),background=document.getElementById("background"),welcomeScreen=document.getElementById("welcome"),loadingScreen=document.getElementById("loading"),weatherArea=document.getElementById("weather"),locationArea=document.getElementById("location");weatherArea.style.display="none";const hiddenfcArea=document.querySelector(".hidden-fc"),expandfcArea=document.querySelector(".expand-fc");expandfcArea.addEventListener("click",()=>{"none"===hiddenfcArea.style.display?(hiddenfcArea.style.display="block",expandfcArea.style.borderTop="1px solid var(--border)",expandfcArea.innerHTML="Hide rows"):"block"===hiddenfcArea.style.display&&(hiddenfcArea.style.display="none",expandfcArea.style.borderTop="none",expandfcArea.innerHTML="Show 4 more rows")});let date=new Date,addDays=e=>{let t=new Date;return t.setDate(t.getDate()+e),t};const firstdaymm=document.getElementById("fc-firstday"),seconddaymm=document.getElementById("fc-secondday"),thirddaymm=document.getElementById("fc-thirdday"),fourthdaymm=document.getElementById("fc-fourthday"),fifthdaymm=document.getElementById("fc-fifthday"),sixthdaymm=document.getElementById("fc-sixthday"),seventhdaymm=document.getElementById("fc-seventhday"),fcfirstimg=document.getElementById("fc-firstimg"),fcssecondimg=document.getElementById("fc-secondimg"),fcthirdimg=document.getElementById("fc-thirdimg"),fcfourthimg=document.getElementById("fc-fourthimg"),fcfifthimg=document.getElementById("fc-fifthimg"),fcsixthimg=document.getElementById("fc-sixthimg"),fcseventhimg=document.getElementById("fc-seventhimg"),temperatureArea=document.getElementById("current-temperature"),windSpeed=document.getElementById("wind-speed"),feelsLike=document.getElementById("feels-like"),humidity=document.getElementById("humidity"),uvIndex=document.getElementById("uv-index"),dateArea=document.getElementById("date");dateArea.innerHTML=date.toLocaleDateString();const status=document.getElementById("status"),thirdDay=document.getElementById("third-day-date"),fourthDay=document.getElementById("fourth-day-date"),fifthDay=document.getElementById("fifth-day-date"),sixthDay=document.getElementById("sixth-day-date"),seventhDay=document.getElementById("seventh-day-date");thirdDay.innerHTML=addDays(2).toDateString().slice(0,-5),fourthDay.innerHTML=addDays(3).toDateString().slice(0,-5),fifthDay.innerHTML=addDays(4).toDateString().slice(0,-5),sixthDay.innerHTML=addDays(5).toDateString().slice(0,-5),seventhDay.innerHTML=addDays(6).toDateString().slice(0,-5);const windSpeedLogo=document.querySelector(".wind-speed-logo"),weatherIcon=document.querySelector(".weather-icon");let createStars=()=>{for(let e=0;e<80;e++){let e=document.createElement("span");e.classList.add("twinkle"),e.style.top=100*Math.random()+"vh",e.style.left=100*Math.random()+"vw",e.style.height=e.style.width=1+2*Math.random()+"px",e.style.animationDelay=1+4*Math.random()+"s",background.append(e)}},createSnow=()=>{for(let e=0;e<70;e++){let e=document.createElement("span");e.classList.add("snowflake"),e.style.top=100*Math.random()+"vh",e.style.left=90*Math.random()+"vw",e.style.height=e.style.width=5+10*Math.random()+"px",e.style.animationDuration=1+4*Math.random()+"s",e.style.fontSize=.75+.5*Math.random()+"rem",e.style.opacity=.5+Math.random(),background.append(e)}},createClouds=()=>{for(let e=0;e<5;e++){let e=document.createElement("span");e.classList.add("clouds"),e.style.top=0+20*Math.random()+"vh",e.style.left=5+5*Math.random()+"vw",e.style.animationDuration=7+10*Math.random()+"s",e.style.transform=`scale(${.2+Math.random()})`,e.style.opacity=.5+.5*Math.random(),background.append(e)}},createRain=()=>{for(let e=0;e<100;e++){let e=document.createElement("span");e.classList.add("raindrop"),e.style.top=100*Math.random()+"vh",e.style.left=100*Math.random()+"vw",e.style.height=10+15*Math.random()+"px",e.style.width=1+1*Math.random()+"px",e.style.animationDuration=1+1*Math.random()+"s",background.append(e)}},createFog=()=>{for(let e=0;e<20;e++){let e=document.createElement("span");e.classList.add("fog"),e.style.top=2+50*Math.random()+"vh",e.style.left=100*Math.random()+"vw",e.style.height=120+10*Math.random()+"px",e.style.width=60+10*Math.random()+"px",e.style.margin=2+5*Math.random()+"px",e.style.animationDelay=4*Math.random()-10+"s",e.style.animationDuration=10+10*Math.random()+"s",background.append(e)}},createThunder=()=>{let e=document.createElement("div");e.classList.add("thunder"),background.append(e)},snowWeather=()=>{createSnow(),background.classList.add("snow");let e=document.createElement("div");e.classList.add("snow-flake-icon"),weatherIcon.append(e),metaTheme.setAttribute("content","#2395ff")},clearWeather=(e="day")=>{background.classList.add("clear");let t=document.createElement("div");t.classList.add("sun");let a=document.createElement("div");a.classList.add("flare-one");let n=document.createElement("div");n.classList.add("flare-two");let d=document.createElement("div");if(d.classList.add("flare-three"),t.append(a),t.append(n),t.append(d),weatherIcon.append(t),metaTheme.setAttribute("content","#5896fd"),"night"==e){background.classList.add("night"),createStars(),metaTheme.setAttribute("content","#021a48"),t.remove();let e=document.createElement("div");e.classList.add("moon"),weatherIcon.append(e)}},fogWeather=()=>{background.classList.add("foggy"),createFog(),metaTheme.setAttribute("content","#333")},rainWeather=()=>{background.classList.add("rainy"),createRain(),metaTheme.setAttribute("content","#616161")},thunderWeather=()=>{background.classList.add("rainy"),createRain(),createThunder(),metaTheme.setAttribute("content","#616161")},cloudyWeather=()=>{background.classList.add("cloudy"),createClouds(),metaTheme.setAttribute("content","#63a4ff")},convertTimestamptoTime=e=>{let t=new Date(1e3*e);t.toUTCString();let a=t.getHours(),n=a>12?"PM":"AM";a=(a=0==a?12:a)>12?a-12:a;let d=t.getMinutes();return a+":"+(d=d<10?"0"+d:d)+" "+n},isdayorNight=(e,t)=>{let a=new Date(1e3*e),n=new Date(1e3*t);return date.getTime()>=a.getTime()&&date.getTime()<=n.getTime()?"day":"night"},getWeatherIcon=e=>"Fog"==e||"Mist"==e||"Smoke"==e||"Haze"==e?"fog.png":"Snow"==e?"snow.png":"Rain"==e||"Drizzle"==e?"rain.png":"Thunderstorm"==e?"thunder.png":"Clear"==e?"sun.png":"Clouds"==e?"clouds.png":"sun.png",updateWeather=e=>{(e=>{const t=document.querySelector(".hourly-forecast ul");for(let a=0;a<24;a++){let n=document.createElement("li"),d=document.createElement("div");d.classList.add("h-wdesc"),d.innerHTML=e[a].weather[0].main;let r=document.createElement("div");r.classList.add("h-wicon");let o=document.createElement("img");o.src="images/"+getWeatherIcon(e[a].weather[0].main),r.append(o);let i=document.createElement("div");i.classList.add("h-wtemp"),i.innerHTML=Math.round(e[a].temp)+"&deg; C";let s=document.createElement("div");s.classList.add("h-wts"),s.innerHTML=convertTimestamptoTime(e[a].dt),n.append(d),n.append(r),n.append(i),n.append(s),t.append(n)}})(e.hourly),loadingScreen.style.display="none",weatherArea.style.display="block",temperatureArea.innerHTML=Math.round(e.current.temp)+'<span class="units">&deg; C</span>',status.innerHTML=e.current.weather[0].main,firstdaymm.innerHTML=Math.round(e.daily[0].temp.max)+" / "+Math.round(e.daily[0].temp.min),seconddaymm.innerHTML=Math.round(e.daily[1].temp.max)+" / "+Math.round(e.daily[1].temp.min),thirddaymm.innerHTML=Math.round(e.daily[2].temp.max)+" / "+Math.round(e.daily[2].temp.min),fourthdaymm.innerHTML=Math.round(e.daily[3].temp.max)+" / "+Math.round(e.daily[3].temp.min),fifthdaymm.innerHTML=Math.round(e.daily[4].temp.max)+" / "+Math.round(e.daily[4].temp.min),sixthdaymm.innerHTML=Math.round(e.daily[5].temp.max)+" / "+Math.round(e.daily[5].temp.min),seventhdaymm.innerHTML=Math.round(e.daily[6].temp.max)+" / "+Math.round(e.daily[6].temp.min),fcfirstimg.src="images/"+getWeatherIcon(e.daily[0].weather[0].main),fcssecondimg.src="images/"+getWeatherIcon(e.daily[1].weather[0].main),fcthirdimg.src="images/"+getWeatherIcon(e.daily[2].weather[0].main),fcfourthimg.src="images/"+getWeatherIcon(e.daily[3].weather[0].main),fcfifthimg.src="images/"+getWeatherIcon(e.daily[4].weather[0].main),fcsixthimg.src="images/"+getWeatherIcon(e.daily[5].weather[0].main),fcseventhimg.src="images/"+getWeatherIcon(e.daily[6].weather[0].main),windSpeed.innerHTML=e.current.wind_speed+" KM/H",windSpeedLogo.style.transform=`rotate(${-(e.current.wind_deg+90)}deg)`,feelsLike.innerHTML=Math.round(e.current.feels_like)+"&deg; C",humidity.innerHTML=e.current.humidity+" %",uvIndex.innerHTML=e.current.uvi;let t=e.current.weather[0].main;"Fog"==t||"Mist"==t||"Smoke"==t||"Haze"==t?fogWeather():"Snow"==t?snowWeather():"Rain"==t||"Drizzle"==t?rainWeather():"Thunderstorm"==t?thunderWeather():"Clear"==t?clearWeather(isdayorNight(e.current.sunrise,e.current.sunset)):"Clouds"==t&&cloudyWeather()},setCityName=(e,t)=>{fetch(`https://us1.locationiq.com/v1/reverse.php?key=pk.dcab92669c73783dabaf15bde712e1ad&lat=${e}&lon=${t}+&format=json`).then(e=>{if(200!==e.status)return"";e.json().then(e=>{let t=e.address.city;null==t&&(t=e.address.county),null==t&&(t=e.address.state);let a=localStorage.getItem("cityName");locationArea.innerHTML=null==a?t+", ":a==t?t+", ":a+", "+t+", "})})},fetchWeather=(e,t)=>{loadingScreen.style.display="block";fetch(`https://api.openweathermap.org/data/2.5/onecall?lat=${e}&lon=${t}&units=metric&appid=2977f1166346a711b4adb6ac5cb8ca4c`).then(e=>{weatherArea.style.display="block",200===e.status?e.json().then(e=>{updateWeather(e)}):console.log("Looks like there was a problem. Status Code: "+e.status)}).catch(e=>{console.log("Fetch Error :",e)})},getCityPopup=()=>{let e=localStorage.getItem("latitude"),t=localStorage.getItem("longitude");null==e||null==t?welcomeScreen.style.display="flex":(setCityName(e,t),fetchWeather(e,t))},startApp=()=>{metaTheme.setAttribute("content","#FC466B"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const t=e.coords.latitude,a=e.coords.longitude;localStorage.clear(),setCityName(t,a),fetchWeather(t,a)},()=>{getCityPopup()})};startApp();const form=document.querySelector("#welcome form");form.addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("city").value.trim();fetch(`https://us1.locationiq.com/v1/search.php?key=pk.dcab92669c73783dabaf15bde712e1ad&format=json&q=${t}`).then(e=>{if(200!==e.status){document.getElementById("err-c-msg").innerHTML="* Invalid city. Please enter a valid city."}e.json().then(e=>{let a=e[0].lat,n=e[0].lon;localStorage.setItem("latitude",a),localStorage.setItem("longitude",n),localStorage.setItem("cityName",t),welcomeScreen.style.display="none",setCityName(a,n),fetchWeather(a,n)})})});
